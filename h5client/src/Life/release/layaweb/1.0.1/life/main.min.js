var Wallet=function(){function t(){this.goldCoin=0,this.silverCoin=0,this.copperCoin=0,this.goldCoin=0,this.silverCoin=0,this.copperCoin=0}return t.prototype.changeMoney=function(t,i,e){this.goldCoin+=t,this.silverCoin+=i,this.copperCoin+=e},t.prototype.isEnough=function(t,i,e){return this.goldCoin>t?!0:this.goldCoin==t&&this.silverCoin>i?!0:this.goldCoin==t&&this.silverCoin==i&&this.copperCoin>=e},t}(),Person=function(){function t(){this.wallet=new Wallet}return t}(),GM=function(){function t(){this.game=null}return t.instance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.setGame=function(t){this.game=t},t.prototype.getGame=function(){return this.game},t.prototype.setLogLevel=function(i){t.logLevel=i},t.prototype.logMsg=function(i,e,n){i>=t.logLevel&&console.log("[*"+e+"*]: "+n)},t.prototype.logD=function(i){this.logMsg(t.DEBUG,"DEBUG",i)},t.prototype.logI=function(i){this.logMsg(t.INFO,"INFO",i)},t.prototype.logW=function(i){this.logMsg(t.WARN,"WARN",i)},t.prototype.logE=function(i){this.logMsg(t.ERROR,"ERROR",i)},t}();GM._instance=null,GM.logLevel=0,GM.DEBUG=0,GM.INFO=1,GM.WARN=2,GM.ERROR=3;var Game=function(){function t(t,i,e){this.stageWidth=0,this.stageHeight=0,this.useWebGL=!1,this.stage=null,this.timer=null,this.currentScene=null,this.stageWidth=t,this.stageHeight=i,this.useWebGL=e,this.useWebGL?Laya.init(this.stageWidth,this.stageHeight,Laya.WebGL):Laya.init(this.stageWidth,this.stageHeight),this.stage=Laya.stage,this.timer=Laya.timer,this.stage.screenMode="horizontal",this.stage.scaleMode="showall",this.stage.bgColor="#232628",this.stage.alignV=Laya.Stage.ALIGN_MIDDLE,this.stage.alignH=Laya.Stage.ALIGN_CENTER}return t.prototype.getStageWidth=function(){return this.stageWidth},t.prototype.getStageHeight=function(){return this.stageHeight},t.prototype.isWebGL=function(){return this.useWebGL},t.prototype.setScene=function(t){null!=this.currentScene&&(this.currentScene.removeSelf(),this.currentScene.destory()),this.currentScene=t,null!=this.currentScene?(this.currentScene.init(),Laya.stage.addChild(this.currentScene)):console.error('Can\'t post null to function "setScene"')},t.prototype.getScene=function(){return this.currentScene},t.prototype.getTimer=function(){return this.timer},t.prototype.showGameStat=function(t,i){laya.utils.Stat.show(0,0)},t.prototype.start=function(){this.timer.frameLoop(1,this,this.act,[this.timer.delta])},t.prototype.act=function(t){null!=this.currentScene&&this.currentScene.act(t)},t.prototype.pause=function(){null!=this.currentScene&&this.currentScene.pause()},t.prototype.resume=function(){null!=this.currentScene&&this.currentScene.resume()},t.prototype.destory=function(){null!=this.currentScene&&this.currentScene.destory()},t}(),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Actor=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.act=function(t){},i}(Laya.Sprite),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Group=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(Actor),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Layer=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(Group),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Scene=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.init=function(){},i.prototype.act=function(t){},i.prototype.pause=function(){},i.prototype.resume=function(){},i.prototype.destory=function(){},i}(Laya.Node),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},GameMap=function(t){function i(){var i=t.call(this)||this;return i.mapCellWidth=0,i.mapCellHeight=0,i.mapWidth=0,i.mapHeight=0,i.debugArea=!1,i.select=0,i.building1ok=!0,i.building2ok=!0,i.building3ok=!0,i.old_x=0,i.old_y=0,i.dragStartX=0,i.dragStartY=0,i.width=4e3,i.height=2400,i.mapCellWidth=16,i.mapCellHeight=16,i.mapWidth=Math.floor(i.width/i.mapCellWidth),i.mapHeight=Math.floor(i.height/i.mapCellHeight),i.mouseEnabled=!0,i.on("mousedown",i,i.onMouseDown),i.on("mouseup",i,i.onMouseUp),i.on("dragstart",i,i.onDragStart),i.on("dragmove",i,i.onDragMove),i.init(),i}return __extends(i,t),i.prototype.init=function(){this.map=new Array;for(var t=0;t<this.mapWidth;t++){this.map.push(new Array);for(var i=0;i<this.mapHeight;i++)this.map[t].push(0)}for(var t=0;t<this.mapWidth+1;t++)this.graphics.drawLine(t*this.mapCellWidth,0,t*this.mapCellWidth,this.mapCellHeight*this.mapHeight,"#ff0000",1);for(var t=0;t<this.mapHeight+1;t++)this.graphics.drawLine(0,t*this.mapCellHeight,this.mapCellWidth*this.mapWidth,t*this.mapCellHeight,"#ff0000",1)},i.prototype.onLoaded=function(t){switch(t){case 1:this.building1ok=!0;break;case 2:this.building2ok=!0;break;case 3:this.building3ok=!0}},i.prototype.onDragStart=function(t){this.old_x=this.x,this.old_y=this.y,this.dragStartX=this.stage.mouseX,this.dragStartY=this.stage.mouseY,GM.instance().logD("DragStart!")},i.prototype.onDragMove=function(t){this.pos(Laya.stage.mouseX-this.dragStartX+this.old_x,Laya.stage.mouseY-this.dragStartY+this.old_y)},i.prototype.onMouseDown=function(t){if(0==this.select)this.startDrag();else{var i=Laya.stage.mouseX-this.x,e=Laya.stage.mouseY-this.y;i/=this.mapCellWidth,i=Math.floor(i),e/=this.mapCellHeight,e=Math.floor(e);var n=!0;if(i-=Math.floor(Math.ceil(this.building.width/this.mapCellWidth)/2),e-=Math.floor(Math.ceil(this.building.height/this.mapCellHeight)/2),0>i||0>e||i+Math.ceil(this.building.width/this.mapCellWidth)>this.mapWidth||e+Math.ceil(this.building.height/this.mapCellHeight)>this.mapHeight)return;for(var o=i;o<i+Math.ceil(this.building.width/this.mapCellWidth);o++)for(var s=e;s<e+Math.ceil(this.building.height/this.mapCellHeight);s++)0!=this.map[o][s]&&(n=!1);if(n){this.building.pos(i*this.mapCellWidth,e*this.mapCellHeight),this.debugArea&&this.graphics.drawRect(i*this.mapCellWidth,e*this.mapCellHeight,this.mapCellWidth*Math.ceil(this.building.width/this.mapCellWidth),this.mapCellHeight*Math.ceil(this.building.height/this.mapCellHeight),"#00FF00");for(var o=i;o<i+Math.ceil(this.building.width/this.mapCellWidth);o++)for(var s=e;s<e+Math.ceil(this.building.height/this.mapCellHeight);s++)this.map[o][s]=1;this.building.alpha=1,this.select=0,this.building=null}}},i.prototype.onMouseUp=function(t){this.stopDrag()},i.prototype.onMouseMove=function(t){if(0!=this.select){var i=Laya.stage.mouseX-this.x,e=Laya.stage.mouseY-this.y;i/=this.mapCellWidth,i=Math.floor(i),e/=this.mapCellHeight,e=Math.floor(e),i-=Math.floor(Math.ceil(this.building.width/this.mapCellWidth)/2),e-=Math.floor(Math.ceil(this.building.height/this.mapCellHeight)/2),this.debugArea&&this.graphics.drawRect(i*this.mapCellWidth,e*this.mapCellHeight,this.mapCellWidth*Math.ceil(this.building.width/this.mapCellWidth),this.mapCellHeight*Math.ceil(this.building.height/this.mapCellHeight),"#00FF00"),this.building.pos(i*this.mapCellWidth,e*this.mapCellHeight)}},i.prototype.setSelect=function(t){if(0==this.select){this.select=t,this.building=new Laya.Sprite,this.building.alpha=.5,this.building.loadImage("res/building"+this.select+".png"),this.building.autoSize=!0,this.addChild(this.building),this.on("mousemove",this,this.onMouseMove);var i=Laya.stage.mouseX-this.x,e=Laya.stage.mouseY-this.y;i/=this.mapCellWidth,i=Math.floor(i),e/=this.mapCellHeight,e=Math.floor(e),i-=Math.floor(Math.ceil(this.building.width/this.mapCellWidth)/2),e-=Math.floor(Math.ceil(this.building.height/this.mapCellHeight)/2),this.debugArea&&this.graphics.drawRect(i*this.mapCellWidth,e*this.mapCellHeight,this.mapCellWidth*Math.ceil(this.building.width/this.mapCellWidth),this.mapCellHeight*Math.ceil(this.building.height/this.mapCellHeight),"#00FF00"),this.building.pos(i*this.mapCellWidth,e*this.mapCellHeight)}},i.prototype.clearSelect=function(){0!=this.select&&(this.building.removeSelf(),this.building=null,this.select=0)},i.prototype.clearAll=function(){this.clearSelect(),this.destroyChildren();for(var t=0;t<this.mapWidth;t++)for(var i=0;i<this.mapHeight;i++)this.map[t][i]=0},i}(Actor),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},MapCell=function(){function t(){this.x=0,this.y=0,this.type=0,this.owner=0,this.price=0,this.forSale=!1}return t.prototype.isForSale=function(){return this.forSale},t.prototype.sell=function(t){this.price=t,this.forSale=!0},t.prototype.buy=function(t){},t}();MapCell.BLANK=0,MapCell.GRASSLAND=1,MapCell.WOODS=2,MapCell.WATER=3,MapCell.BUILDING=4;var WaterMapCell=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(MapCell),GrasslandMapCell=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(MapCell),WoodsMapCell=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(MapCell),BlankMapCell=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(MapCell),BuildingMapCell=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(MapCell),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},LifeGame=function(t){function i(i,e,n){var o=t.call(this,i,e,n)||this;return o.init(),o}return __extends(i,t),i.prototype.init=function(){this.map=new GameMap,this.stage.addChild(this.map),Laya.loader.load("res/atlas/comp.json",Laya.Handler.create(this,this.onLoaded),null,Laya.Loader.ATLAS)},i.prototype.onLoaded=function(){var t=new BuildingList;this.stage.addChild(t),t.setGameMap(this.map)},i}(Game),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(t){var i=function(i){function e(){return i.call(this)||this}return __extends(e,i),e.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.createView(t.BuildingListUI.uiView)},e}(View);i.uiView={type:"View",props:{width:800,label:"取消选择",height:30},child:[{type:"Button",props:{y:5,x:5,"var":"buildingBtn1",skin:"comp/button.png",label:"建筑1"}},{type:"Button",props:{y:5,x:95,"var":"buildingBtn2",skin:"comp/button.png",label:"建筑2"}},{type:"Button",props:{y:5,x:185,"var":"buildingBtn3",skin:"comp/button.png",label:"建筑3"}},{type:"Button",props:{y:5,x:640,"var":"clearBtn",skin:"comp/button.png",label:"取消选择"}},{type:"Button",props:{y:5,x:720,"var":"clearAllBtn",skin:"comp/button.png",label:"清除所有"}},{type:"Button",props:{y:4,x:275,"var":"buildingBtn4",skin:"comp/button.png",label:"建筑4"}},{type:"Button",props:{y:5,x:365,"var":"buildingBtn5",skin:"comp/button.png",label:"建筑5"}},{type:"Button",props:{y:5,x:455,"var":"buildingBtn6",skin:"comp/button.png",label:"建筑6"}},{type:"Button",props:{y:5,x:545,"var":"buildingBtn7",skin:"comp/button.png",label:"建筑7"}}]},t.BuildingListUI=i}(ui||(ui={}));var PersonInfo=function(){function t(){this.userid=1e4,this.gold=0,this.silver=0,this.copper=0}return t}(),MapCellInfo=function(){function t(){this.x=0,this.y=0}return t}(),TestDataAccess=function(){function t(){}return t.prototype.getPersonInfo=function(t){var i=new PersonInfo;return i.copper=10,i.gold=10,i.silver=10,i.userid=1e4,i},t.prototype.setPersonInfo=function(t){},t.prototype.getMapCellInfo=function(t,i){return new MapCellInfo},t}(),__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},BuildingList=function(t){function i(){var i=t.call(this)||this;return i.hasMap=!1,i.map=null,i.select=0,i.init(),i}return __extends(i,t),i.prototype.init=function(){this.buildingBtn1.on("click",this,this.onClick,[1]),this.buildingBtn2.on("click",this,this.onClick,[2]),this.buildingBtn3.on("click",this,this.onClick,[3]),this.buildingBtn4.on("click",this,this.onClick,[4]),this.buildingBtn5.on("click",this,this.onClick,[5]),this.buildingBtn6.on("click",this,this.onClick,[6]),this.buildingBtn7.on("click",this,this.onClick,[7]),this.clearBtn.on("click",this,this.onClearBtn),this.clearAllBtn.on("click",this,this.onClearAll)},i.prototype.onClick=function(t,i){this.select=t,this.hasMap&&this.map.setSelect(this.select),GM.instance().logI("Select building "+this.select)},i.prototype.onClearBtn=function(){this.select=0,this.hasMap&&this.map.clearSelect(),GM.instance().logI("Clear select building")},i.prototype.onClearAll=function(){this.select=0,this.hasMap&&this.map.clearAll(),GM.instance().logI("Clear all")},i.prototype.setGameMap=function(t){this.hasMap=!0,this.map=t},i}(ui.BuildingListUI);GM.instance().logI("Create game instance!");var game=new LifeGame(800,480,!0);GM.instance().logI("Register game to manager!"),GM.instance().setGame(game),GM.instance().logI("Start game"),GM.instance().getGame().start();